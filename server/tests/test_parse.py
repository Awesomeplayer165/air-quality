# Copyright 2020
#
# pytest file
# Best invoked from the server/ directory as pytest tests/

import sys
import pytest
from pathlib import Path

sys.path.append(str(Path(__file__).parents[1] / "update_data/"))
import purpleair

SAMPLE_DATA = """{
  "api_version" : "V1.0.6-0.0.9",
  "time_stamp" : 1608141357,
  "data_time_stamp" : 1608141326,
  "location_type" : 1,
  "max_age" : 300,
  "fields" : [
    "sensor_index",
    "latitude",
    "longitude",
    "last_seen",
    "pm2.5_10minute",
    "pm2.5_30minute",
    "pm2.5_60minute",
    "pm2.5_6hour",
    "pm2.5_24hour",
    "humidity"
  ],
  "data" : [
    [65539,38.295,-122.4606,1608141289,2.3,2.3,2.3,1.7,1.1,31],
    [65543,37.9084,-122.5563,1608141295,4.5,4.7,4.8,4.4,3.1,25],
    [65545,37.8903,-122.1868,1608141288,4.3,4.2,4.0,2.4,1.1,31],
    [65557,37.7751,-122.4239,1608141279,4.5,3.9,3.2,9.4,8.6,33],
    [65559,37.7775,-122.4686,1608141220,0.2,0.2,0.4,0.7,0.5,33],
    [65561,37.7783,-122.3977,1608141224,0.1,0.1,0.2,8.6,21.1,30],
    [65563,38.3147,-122.3014,1608141144,8.4,9.4,9.7,8.8,7.7,30],
    [65569,37.7377,-122.253,1608141308,3.7,4.5,4.4,3.2,3.7,25],
    [65573,38.3147,-122.3015,1608141322,7.7,7.8,8.0,7.9,6.7,28],
    [65575,38.1623,-122.1787,1608141319,8.8,6.2,5.0,3.9,10.5,21],
    [65577,37.7508,-122.2386,1608141254,2.8,5.2,6.8,5.8,3.7,25],
    [65579,37.7775,-122.4685,1608141112,1.2,1.5,1.5,1.5,1.2,32],
    [65583,37.2928,-122.0053,1608141235,5.3,4.0,3.2,5.0,4.8,30],
    [65589,37.3546,-122.0808,1608141219,4.1,4.2,4.3,4.5,4.5,29],
    [65597,37.8867,-122.2952,1608141223,3.3,3.0,3.0,4.2,4.8,33],
    [65599,37.6903,-122.0425,1608141303,5.1,5.0,4.4,3.5,3.6,24],
    [65603,37.3425,-122.0763,1608141256,3.0,3.1,3.3,7.6,10.5,24],
    [71161,37.2573,-122.0174,1608141209,2.2,2.3,2.2,2.4,2.9,21],
    [71167,37.8959,-122.2961,1608141314,2.8,2.4,2.1,1.3,1.2,null],
    [74559,null,null,1608141265,4.1,3.7,3.3,2.8,5.7,32],
    [71166,37.8959,-122.2961,1608141314,2.8,2.4,null,1.3,1.2,null]
  ]
}"""

def test_parse():
    purpleair.parse_api(SAMPLE_DATA)
